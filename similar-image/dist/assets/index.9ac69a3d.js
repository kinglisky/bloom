var e=Object.assign;import{w as t,r as a,c as s,o as l,a as i,b as n,d as r,v as o,t as u,F as c,e as h,f as g}from"./vendor.547c935e.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(a){const s=new URL(e,location),l=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((a,i)=>{const n=new URL(e,s);if(self[t].moduleMap[n])return a(self[t].moduleMap[n]);const r=new Blob([`import * as m from '${n}';`,`${t}.moduleMap['${n}']=m;`],{type:"text/javascript"}),o=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(r),onerror(){i(new Error(`Failed to import: ${e}`)),l(o)},onload(){a(self[t].moduleMap[n]),l(o)}});document.head.appendChild(o)})),self[t].moduleMap={}}}("/similar-image/dist/assets/");const m=["/similar-image/dist/assets/0.2feaa414.jpeg","/similar-image/dist/assets/1.fd51b679.jpeg"],d=({imageRefs:e,imageSize:t})=>{const s=a(""),l=a([]),i=()=>{const e=document.createElement("canvas");return e.width=t.value,e.height=t.value,e},n=(e,t=4)=>{const a=256/t,s=a/2,l=Array.from({length:Math.pow(t,3)}).fill(0);for(let i=0;i<e.width;i++)for(let n=0;n<e.height;n++){const r=4*(i+n*e.width),o=Math.round((e.data[r+0]+s)/a)-1,u=Math.round((e.data[r+1]+s)/a)-1,c=Math.round((e.data[r+2]+s)/a)-1;l[o*Math.pow(t,2)+u*t+c]+=1}return l};return{compareColorInfo:s,colorsList:l,createColorHistogram:()=>{const[a,r]=(()=>{const a=i(),s=i(),[l,n]=e.value,r=a.getContext("2d"),o=s.getContext("2d");return r.drawImage(l,0,0,l.naturalWidth,l.naturalHeight,0,0,t.value,t.value),o.drawImage(n,0,0,n.naturalWidth,n.naturalHeight,0,0,t.value,t.value),[r.getImageData(0,0,a.width,a.height),o.getImageData(0,0,s.width,s.height)]})(),o=n(a),u=n(r);l.value=[o,u];const c=((e,t)=>{let a=0,s=0,l=0;for(let i=0;i<e.length;i++)a+=e[i]*t[i],s+=Math.pow(e[i],2),l+=Math.pow(t[i],2);return a/(Math.sqrt(s)*Math.sqrt(l))})(o,u);s.value=`颜色向量相似度为：${100*c}%`}}},v={name:"App",setup(){const l=(()=>{const e=a(64),t=s((()=>({"--width":`${e.value}px`,"--height":`${e.value}px`}))),l=a([]),i=a([...m]);return{imageSize:e,imageStyles:t,imageRefs:l,imageUrls:i,updateImageUrls:e=>{let t=[...e.target.files].slice(0,2).map((e=>URL.createObjectURL(e)));t.length<2&&(t=[...t,...m].slice(0,2)),i.value=t}}})(),i=(({imageRefs:e,imageSize:t})=>{const s=a([]),l=a(!1),i=a([]),n=(e,t,a)=>parseInt(.299*e+.587*t+.114*a),r=e=>{const t=e.getContext("2d"),a=t.getImageData(0,0,e.width,e.height),s=[],l=new ImageData(a.width,a.height);for(let i=0;i<a.width;i++)for(let e=0;e<a.height;e++){const t=4*(i+e*a.width),r=a.data[t+0],o=a.data[t+1],u=a.data[t+2],c=n(r,o,u);l.data[t+0]=c,l.data[t+1]=c,l.data[t+2]=c,l.data[t+3]=255,s.push(c)}return t.putImageData(l,0,0),{originData:a,grayData:s}};return{grayCavans:s,canvasData:i,hasGrayOutput:l,setGrayOutput:()=>{const[a,n]=e.value,[o,u]=s.value,c=o.getContext("2d"),h=u.getContext("2d");c.drawImage(a,0,0,a.naturalWidth,a.naturalHeight,0,0,t.value,t.value),h.drawImage(n,0,0,n.naturalWidth,n.naturalHeight,0,0,t.value,t.value),i.value=[r(o),r(u)],l.value=!0}}})(l),n=(({canvasData:e})=>{const t=a([]),s=a([]),l=e=>{let t=0;for(let a=0;a<e.length-1;a+=4)t+=e[a];return Math.round(t/(e.length/4))},i=e=>{let t=0,a=Array(256).fill(0),s=e.length;for(;t<s;)a[e[t++]]++;let l=0;for(let c=0;c<256;c++)l+=c*a[c];let i=0,n=0,r=0,o=0,u=0;for(let c=0;c<256;c++){if(i+=a[c],0===i)continue;if(n=s-i,0===n)break;r+=c*a[c];let e=i*n*(r/i-(l-r)/n)**2;e>o&&(o=e,u=c)}return u},n=(e,t,a)=>{const{width:s,height:l,data:i}=t,n=[];for(let o=0;o<s;o++)for(let t=0;t<l;t++){const s=4*(o+t*e.width),l=(i[s]+i[s+1]+i[s+2])/3>a?255:0;i[s]=l,i[s+1]=l,i[s+2]=l,n.push(l>0?1:0)}const r=e.getContext("2d");return r.clearRect(0,0,e.width,e.height),r.putImageData(t,0,0),n};return{extremumCanvas:t,setAverageOutput:()=>{const a=l(e.value[0].grayData),i=l(e.value[1].grayData);console.log(a,i);const[r,o]=t.value,u=n(r,e.value[0].originData,a),c=n(o,e.value[1].originData,i);s.value=[u,c]},setOtsuOutput:()=>{const a=i(e.value[0].grayData),l=i(e.value[1].grayData);console.log(a,l);const[r,o]=t.value,u=n(r,e.value[0].originData,a),c=n(o,e.value[1].originData,l);s.value=[u,c]},hashData:s}})(i),r=(e=>{const s=a("");return t(e,(e=>{if(!e.length)return;const[t,a]=e;let l=0;t.forEach(((e,t)=>{l+=e^a[t]})),s.value=`差异: ${l}, 相似度: ${(t.length-l)/t.length*100}%`,console.log(s.value)})),{compareHashInfo:s}})(n.hashData),o=d(l),u=()=>{i.hasGrayOutput.value=!1,n.hashData.value=[],o.colorsList.value=[],o.compareColorInfo.value=""};return t(l.imageUrls,u),t(l.imageSize,u),e(e(e(e(e({},l),i),n),o),r)}},p={class:"header"},f={class:"header-item upload"},w=n("label",{for:"upload"},"图片上传",-1),y={class:"header-item size"},z=n("span",null,"图片尺寸",-1),S={class:"panel"},C=n("span",{class:"title"},"原始图片",-1),D={class:"contents"},O={class:"panel"},I={class:"title"},x={class:"contents"},U={key:0,class:"panel"},b={class:"title"},M=n("span",null,"二值化",-1),k={class:"contents"},R={key:1,class:"panel"},L=n("div",{class:"title"},"特征值比较",-1),j={class:"contents"},H={class:"contents"},$={class:"compare-info"},A={key:2,class:"panel"},G={class:"title"},E={class:"contents"},W={class:"contents"},_={class:"compare-info"};v.render=function(e,t,a,s,g,m){return l(),i("main",{class:"similar-images",style:e.imageStyles},[n("div",p,[n("button",f,[w,n("input",{multiple:"",id:"upload-btn",type:"file",accept:"image/*",onChange:t[1]||(t[1]=(...t)=>e.updateImageUrls&&e.updateImageUrls(...t))},null,32)]),n("div",y,[z,r(n("input",{type:"range",placeholder:"图片尺寸",min:"8",max:"256",step:"4","onUpdate:modelValue":t[2]||(t[2]=t=>e.imageSize=t)},null,512),[[o,e.imageSize]]),n("span",null,u(e.imageSize)+"px",1)])]),e.imageUrls.length?(l(),i(c,{key:0},[n("div",S,[C,n("div",D,[n("img",{class:"content-item",src:e.imageUrls[0],ref:t=>e.imageRefs[0]=t},null,8,["src"]),n("img",{class:"content-item",src:e.imageUrls[1],ref:t=>e.imageRefs[1]=t},null,8,["src"])])]),n("div",O,[n("span",I,[n("button",{onClick:t[3]||(t[3]=(...t)=>e.setGrayOutput&&e.setGrayOutput(...t))},"灰度")]),n("div",x,[n("canvas",{class:"content-item",width:e.imageSize,height:e.imageSize,ref:t=>e.grayCavans[0]=t},null,8,["width","height"]),n("canvas",{class:"content-item",width:e.imageSize,height:e.imageSize,ref:t=>e.grayCavans[1]=t},null,8,["width","height"])])]),e.hasGrayOutput?(l(),i("div",U,[n("div",b,[n("button",{onClick:t[4]||(t[4]=(...t)=>e.setAverageOutput&&e.setAverageOutput(...t))},"average"),n("button",{onClick:t[5]||(t[5]=(...t)=>e.setOtsuOutput&&e.setOtsuOutput(...t))},"otsu"),M]),n("div",k,[n("canvas",{class:"content-item",width:e.imageSize,height:e.imageSize,ref:t=>e.extremumCanvas[0]=t},null,8,["width","height"]),n("canvas",{class:"content-item",width:e.imageSize,height:e.imageSize,ref:t=>e.extremumCanvas[1]=t},null,8,["width","height"])])])):h("",!0),e.hashData.length?(l(),i("div",R,[L,n("div",j,[n("textarea",{class:"content-item keep-size",readonly:"",width:e.imageSize,height:e.imageSize,value:e.hashData[0]},null,8,["width","height","value"]),n("textarea",{class:"content-item keep-size",readonly:"",width:e.imageSize,height:e.imageSize,value:e.hashData[1]},null,8,["width","height","value"])]),n("div",H,[n("h2",$,u(e.compareHashInfo),1)])])):h("",!0),e.imageUrls.length?(l(),i("div",A,[n("div",G,[n("button",{onClick:t[6]||(t[6]=(...t)=>e.createColorHistogram&&e.createColorHistogram(...t))},"颜色向量比较")]),n("div",E,[n("textarea",{class:"content-item keep-size",readonly:"",width:e.imageSize,height:e.imageSize,value:e.colorsList[0]},null,8,["width","height","value"]),n("textarea",{class:"content-item keep-size",readonly:"",width:e.imageSize,height:e.imageSize,value:e.colorsList[1]},null,8,["width","height","value"])]),n("div",W,[n("h2",_,u(e.compareColorInfo),1)])])):h("",!0)],64)):h("",!0)],4)};g(v).mount("#app");
