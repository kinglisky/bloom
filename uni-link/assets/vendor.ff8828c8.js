function n(n,t){for(var e=0;e<t.length;e++){var o=t[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,o.key,o)}}function t(){return(t=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n}).apply(this,arguments)}var e,o,i,a=navigator.userAgent||"",c=/android/i.test(a),r=/iphone|ipad|ipod/i.test(a),u=/micromessenger\/([\d.]+)/i.test(a),s=/(weibo).*weibo__([\d.]+)/i.test(a),d=/(baiduboxapp)\/([\d.]+)/i.test(a),l=/qq\/([\d.]+)/i.test(a),p=/(qqbrowser)\/([\d.]+)/i.test(a),f=/qzone\/.*_qz_([\d.]+)/i.test(a),v=/chrome\/[\d.]+ mobile safari\/[\d.]+/i.test(a)&&c&&a.indexOf("Version")<0;function h(n,t){var e=n.path,o=n.param,i=t.buildScheme;if(void 0!==i)return i(n,t);var a=t.scheme,c=a.host,r=a.port,u=a.protocol,s=r?":".concat(r):"",d=c?"".concat(c).concat(s,"/"):"",l=void 0!==o?Object.keys(o).map((function(n){return"".concat(n,"=").concat(o[n])})).join("&"):"",p=l?"?".concat(l):"";return"".concat(u,"://").concat(d).concat(e).concat(p)}function m(n,t){var e=t.outChain,o=h(n,t);if(void 0!==e&&e){var i=e.protocol,a=e.path,c=e.key;o="".concat(i,"://").concat(a,"?").concat(c,"=").concat(encodeURIComponent(o))}return o}function b(n){window.top.location.href=n}function y(n){i||((i=document.createElement("iframe")).frameBorder="0",i.style.cssText="display:none;border:0;width:0;height:0;",document.body.append(i)),i.src=n}function g(n,t){var i=setTimeout((function(){void 0!==e&&document[e]||n()}),t);void 0!==o?document.addEventListener(o,(function(){clearTimeout(i)})):window.addEventListener("pagehide",(function(){clearTimeout(i)}))}void 0!==document.hidden?(e="hidden",o="visibilitychange"):void 0!==document.msHidden?(e="msHidden",o="msvisibilitychange"):void 0!==document.webkitHidden&&(e="webkitHidden",o="webkitvisibilitychange");var k=function(){function e(n){var o,i,a;!function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a=void 0,(i="options")in(o=this)?Object.defineProperty(o,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):o[i]=a;this.options=t({timeout:2e3},n)}var o,i,a;return o=e,(i=[{key:"generateScheme",value:function(n){return m(n,this.options)}},{key:"generateIntent",value:function(n){return function(n,t){var e=t.outChain,o=t.intent,i=t.fallback;if(void 0===o)return"";var a=Object.keys(o).map((function(n){return"".concat(n,"=").concat(o[n],";")})).join(""),c="#Intent;".concat(a,"S.browser_fallback_url=").concat(encodeURIComponent(i),";end;"),r=h(n,t);if(void 0!==e&&e){var u=e.path,s=e.key;return"intent://".concat(u,"?").concat(s,"=").concat(encodeURIComponent(r)).concat(c)}return r=r.slice(r.indexOf("//")+2),"intent://".concat(r).concat(c)}(n,this.options)}},{key:"generateUniversalLink",value:function(n){return function(n,t){var e=t.universal;if(void 0===e)return"";var o=e.host,i=e.pathKey,a=n.path,c=n.param,r=void 0!==c?Object.keys(c).map((function(n){return"".concat(n,"=").concat(c[n])})).join("&"):"",u=r?"&".concat(r):"";return"https://".concat(o,"?").concat(i,"=").concat(a).concat(u)}(n,this.options)}},{key:"generateYingYongBao",value:function(n){return function(n,t){var e=m(n,t);return"".concat(t.yingyongbao,"&android_schema=").concat(encodeURIComponent(e))}(n,this.options)}},{key:"checkOpen",value:function(n){var t=this.options,e=t.logFunc;return g((function(){void 0!==e&&e("failure"),n()}),t.timeout)}},{key:"fallToAppStore",value:function(){var n=this;this.checkOpen((function(){b(n.options.appstore)}))}},{key:"fallToFbUrl",value:function(){var n=this;this.checkOpen((function(){b(n.options.fallback)}))}},{key:"fallToCustomCb",value:function(n){this.checkOpen((function(){n()}))}},{key:"open",value:function(n){var t,e,o,i,a=this.options,c=a.universal,h=a.appstore,m=a.logFunc,g=a.intent,k=n.callback,w=void 0!==c,O=this.generateScheme(n);void 0!==m&&m("pending"),r?u&&-1===function(n,t){for(var e=window.isNaN,o=n.split("."),i=t.split("."),a=0;a<3;a++){var c=Number(o[a]),r=Number(i[a]);if(c>r)return 1;if(r>c)return-1;if(!e(c)&&e(r))return 1;if(e(c)&&!e(r))return-1}return 0}(navigator.appVersion.match(/micromessenger\/(\d+\.\d+\.\d+)/i)[1],"7.0.5")||s?b(h):(i=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),Number.parseInt(i[1],10)<9?(y(O),t=this.fallToAppStore):!w||l||p||f?(e=O,(o=document.createElement("a")).setAttribute("href",e),o.style.display="none",document.body.append(o),o.click(),t=this.fallToAppStore):b(this.generateUniversalLink(n))):u&&void 0!==this.options.yingyongbao?b(this.generateYingYongBao(n)):v?void 0!==g?b(this.generateIntent(n)):(b(O),t=this.fallToFbUrl):u||d||s||f?b(this.options.fallback):(y(O),t=this.fallToFbUrl),void 0===k?t&&t.call(this):this.fallToCustomCb(k)}}])&&n(o.prototype,i),a&&n(o,a),e}();export{k as C};
